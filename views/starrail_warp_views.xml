<?xml version="1.0"?>
<odoo>
    <menuitem id="menu_warps_root" name="Warps" sequence="30" web_icon="starrail,static/description/icon(1).png"/>

    <!-- SR.WARP -->
    <record id="starrail_warps_view_tree" model="ir.ui.view">
        <field name="name">starrail.warps.tree</field>
        <field name="model">sr.warp</field>
        <field name="arch" type="xml">
            <tree string="Warps" edit="0">
                <field name="name"/>
                <field name="rank_type"/>
                <field name="time"/>
                <field name="banner_id"/>
                <field name="banner_type_id"/>
            </tree>
        </field>
    </record>

    <record id="starrail_warps_view_form" model="ir.ui.view">
        <field name="name">starrail.warps.form</field>
        <field name="model">sr.warp</field>
        <field name="arch" type="xml">
            <form string="Warps">
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="rank_type"/>
                            <field name="item_type"/>
                            <field name="time"/>
                            <field name="pity"/>
                            <field name="banner_id"/>
                            <field name="banner_type_id"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="starrail_warps_view_search" model="ir.ui.view">
        <field name="name"/>
        <field name="banner_id"/>
        <field name="banner_type_id"/>
        <filter string="5* Warps" name="5_warps" domain="[('rank_type','=',5)]"/>
        <filter string="4* Warps" name="4_warps" domain="[('rank_type','=',4)]"/>
        <separator/>
        <filter string="Event Warps" name="event" domain="[('gacha_type','=',11)]"/>
        <filter string="Light Cone Warps" name="light_cone" domain="[('gacha_type','=',12)]"/>
        <filter string="Standard Warps" name="standard" domain="[('gacha_type','=',1)]"/>
        <filter string="Departure Warps" name="departure" domain="[('gacha_type','=',2)]"/>
        <group expand="0" string="Group By">
            <filter string="Event Banner" name="banner" domain="[]" context="{'group_by': 'banner_id'}"/>
            <filter string="Banner Type" name="banner_type" domain="[]" context="{'group_by': 'banner_type_id'}"/>
            <separator/>
            <filter string="Rarity" name="rarity" domain="[]" context="{'group_by': 'rank_type'}"/>
            <filter string="Drop" name="drop" domain="[]" context="{'group_by': 'name'}"/>
        </group>
    </record>

    <record id="starrail_warp_action" model="ir.actions.act_window">
        <field name="name">Warps</field>
        <field name="res_model">sr.warp</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem id="menu_warps" name="Warps" sequence="0" 
        parent="starrail.menu_warps_root"
        action="starrail_warp_action"/>

    <!-- SR.BANNER -->
    <record id="starrail_banner_view_tree" model="ir.ui.view">
        <field name="name">starrail.banner.tree</field>
        <field name="model">sr.banner</field>
        <field name="arch" type="xml">
            <tree string="Banners">
                <field name="name"/>
                <field name="gacha_type_id"/>
            </tree>
        </field>
    </record>

    <record id="starrail_banner_view_form" model="ir.ui.view">
        <field name="name">starrail.banner.form</field>
        <field name="model">sr.banner</field>
        <field name="arch" type="xml">
            <form string="Banners">
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="active"/>
                            <field name="gacha_type_id"/>
                            <field name="banner_key"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="starrail_banner_action" model="ir.actions.act_window">
        <field name="name">Banners</field>
        <field name="res_model">sr.banner</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem id="menu_banners" name="Banners" sequence="10" 
        parent="starrail.menu_warps_root"
        action="starrail_banner_action"/>
    
    <!-- SR.BANNER.TYPE -->
    <record id="starrail_banner_type_view_tree" model="ir.ui.view">
        <field name="name">starrail.banner.type.tree</field>
        <field name="model">sr.banner.type</field>
        <field name="arch" type="xml">
            <tree string="Banner Types" editable="top">
                <field name="name"/>
                <field name="active"/>
                <field name="pity_level"/>
                <field name="last_warp"/>
                <field name="last_five_star"/>
            </tree>
        </field>
    </record>

    <record id="starrail_banner_type_action" model="ir.actions.act_window">
        <field name="name">Banner Types</field>
        <field name="res_model">sr.banner.type</field>
        <field name="view_mode">tree</field>
    </record>

    <menuitem id="menu_banner_types" name="Banner Types" sequence="20"
        parent="starrail.menu_warps_root"
        action="starrail_banner_type_action"/>

    <!-- PLAYER -->
    <record id="button_starrail_warpdata" model="ir.actions.server">
        <field name="name">Get Warp Data</field>
        <field name="model_id" ref="base.model_res_users"/>
        <field name="state">code</field>
        <field name="code">record.get_warps()</field>
    </record>

    <record id="view_users_form_inherit_sr_player" model="ir.ui.view">
        <field name="name">res.users.form.inherit.starrail</field>
        <field name="model">res.users</field>
        <field name="inherit_id" ref="base.view_users_form"/>
        <field name="mode">extension</field>
        <field name="priority">80</field>
        <field name="arch" type="xml">
            <data>
                <xpath expr="//page" position="before">
                    <page string="Player Data" name="srdata" attrs="{'invisible': [('active','=',False)]}">
                    <group>
                        <field name="sr_uid"/>
                        <field name="sr_update" widget="boolean_toggle"/>
                        <field name="sr_authkey" widget="text" attrs="{'invisible': [('sr_update','=',False)]}"/>
                    </group>
                    <div class="row text-center">
                        <span string="Generate Warps">
                        <button name="get_warps" class="btn-primary btn-lg col-4" type="object" string="Refresh Warps" 
                            attrs="{'invisible': ['|', ('active','=',False), ('sr_update','=',False)]}"/>
                        </span>
                    </div>
                    </page>
                </xpath>
            </data>
        </field>
    </record>
</odoo>